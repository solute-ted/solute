<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solute | 가구가 공간에 녹아드는 순간</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;500&family=Playfair+Display:ital,wght@0,600;1,600&display=swap');

        :root {
            --bg-color: #fcfcfc; 
            --primary-dark: #1a1a1a;
            --accent-green: #4a5d4e;
        }

        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            -webkit-font-smoothing: antialiased;
        }
        
        body, html { 
            height: 100%; width: 100%;
            overflow: hidden; 
            background-color: var(--bg-color); 
            font-family: 'Noto Sans KR', sans-serif; 
        }

        /* 로딩 오버레이 */
        #loading-overlay {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: #fcfcfc;
            display: flex; justify-content: center; align-items: center;
            z-index: 99999; opacity: 0; visibility: hidden;
            transition: opacity 0.2s ease-in-out, visibility 0.2s ease-in-out;
        }
        #loading-overlay.is-loading { opacity: 1 !important; visibility: visible !important; }
        .loading-text { font-family: 'Playfair Display', serif; font-size: 1rem; letter-spacing: 3px; color: var(--primary-dark); }

        /* 네비게이션 */
        header {
            position: fixed; top: 0; width: 100%;
            display: flex; justify-content: space-between; align-items: center;
            padding: 40px 60px; z-index: 10000;
            transform: translateZ(0);
        }
        .logo { 
            font-family: 'Playfair Display', serif; font-size: 1.8rem; font-weight: 600; 
            letter-spacing: 3px; text-decoration: none; color: var(--primary-dark); 
        }
        
        nav { display: flex; align-items: center; position: relative; }
        /* CART 링크 영역을 조금 더 넓게 설정하여 호버 감지 최적화 */
        #cart-link { position: relative; padding-bottom: 10px; margin-bottom: -10px; }
        nav a { text-decoration: none; color: var(--primary-dark); margin-left: 40px; font-size: 0.85rem; letter-spacing: 1px; font-weight: 500; }

        /* --- 미니 장바구니 팝업 CSS --- */
        .mini-cart {
            position: absolute;
            top: 40px; right: 0; /* 헤더와 더 가깝게 조정 */
            width: 280px;
            background: #fff;
            border: 1px solid #eee;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            padding: 20px;
            z-index: 10001;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
            text-align: left;
        }
        /* 마우스가 들어왔을 때 상태 */
        .mini-cart.active { opacity: 1; visibility: visible; transform: translateY(0); }
        
        .mini-cart-header { font-size: 0.7rem; letter-spacing: 1px; color: #aaa; margin-bottom: 15px; border-bottom: 1px solid #f5f5f5; padding-bottom: 10px; text-transform: uppercase; }
        .mini-item { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .mini-img { width: 50px; height: 50px; background: #eee; border-radius: 2px; flex-shrink: 0; }
        .mini-info h4 { font-size: 0.85rem; margin-bottom: 2px; font-weight: 500; color: var(--primary-dark); }
        .mini-info p { font-size: 0.75rem; color: #888; }
        .go-cart-btn { 
            display: block; width: 100%; padding: 12px; 
            background: var(--primary-dark); color: #fff !important; 
            text-align: center; font-size: 0.75rem; text-decoration: none; 
            letter-spacing: 1px; margin-top: 10px; margin-left: 0 !important; 
        }

        /* 메인 히어로 섹션 */
        .hero-container { position: relative; width: 100vw; height: 100vh; background-color: var(--bg-color); }
        .spline-background { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        .spline-background iframe { width: 100%; height: 100%; border: none; transform: scale(1.01); cursor: pointer; touch-action: none; }

        .hero-content {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%) translateZ(0);
            z-index: 2; text-align: center; pointer-events: none;
        }
        .hero-content h1 { font-family: 'Playfair Display', serif; font-size: 5rem; color: var(--primary-dark); line-height: 1.1; margin-bottom: 20px; text-shadow: 0 0 30px rgba(255,255,255,1); }
        .hero-content p { font-size: 1.1rem; letter-spacing: 2px; color: var(--accent-green); font-weight: 300; }

        .scroll-indicator { position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); z-index: 2; font-size: 0.7rem; letter-spacing: 3px; color: #aaa; text-transform: uppercase; }

        @media (max-width: 768px) {
            header { padding: 30px 25px; }
            .hero-content h1 { font-size: 3rem; }
            nav a { margin-left: 20px; }
            .mini-cart { width: 250px; right: -10px; }
        }
    </style>
</head>
<body>

    <div id="loading-overlay">
        <div class="loading-text">SOLUTE</div>
    </div>

    <header>
        <a href="index.html" class="logo">Solute</a>
        <nav>
            <a href="shop.html">SHOP</a>
            <a href="./cart.html" id="cart-link">CART<span id="cart-count"></span></a>

            <div id="mini-cart" class="mini-cart">
                <div class="mini-cart-header">RECENTLY ADDED</div>
                <div id="mini-cart-list"></div>
                <a href="./cart.html" class="go-cart-btn">VIEW ALL CART</a>
            </div>
        </nav>
    </header>

    <main class="hero-container">
        <div class="spline-background">
            <iframe src="https://my.spline.design/3dstackcopycopycopycopy-JmAuSYykJNAnClHAeAwUes9v-fDk/" frameborder="0"></iframe>
        </div>

        <div class="hero-content">
            <p>RECYCLE & MODULE</p>
            <h1>Solute</h1>
        </div>

        <div class="scroll-indicator">Scroll to Explore</div>
    </main>

    <script>
        // 전역 타이머 변수
        let miniCartTimer;

        // 1. 장바구니 수량 및 팝업 데이터 갱신
        function updateCartStatus() {
            const cart = JSON.parse(localStorage.getItem('solute_cart')) || [];
            const totalCount = cart.reduce((sum, item) => sum + item.quantity, 0);
            const countElement = document.getElementById('cart-count');
            if (countElement) {
                countElement.innerText = totalCount > 0 ? `(${totalCount})` : "";
            }

            const miniCartList = document.getElementById('mini-cart-list');
            if (miniCartList && cart.length > 0) {
                const recentItems = [...cart].reverse().slice(0, 3);
                miniCartList.innerHTML = recentItems.map(item => `
                    <div class="mini-item">
                        <div class="mini-img" style="background-color: ${item.color || '#eee'}"></div>
                        <div class="mini-info">
                            <h4>${item.name}</h4>
                            <p>${item.price} (Qty: ${item.quantity})</p>
                        </div>
                    </div>
                `).join('');
            } else if (miniCartList) {
                miniCartList.innerHTML = '<p style="font-size:0.75rem; color:#ccc; margin-bottom:15px;">장바구니가 비어있습니다.</p>';
            }
        }

        // [추가] 마우스 호버 이벤트 제어 함수
        function initCartHoverEvents() {
            const cartLink = document.getElementById('cart-link');
            const miniCart = document.getElementById('mini-cart');

            if (!cartLink || !miniCart) return;

            // CART 링크에 마우스 진입
            cartLink.addEventListener('mouseenter', () => {
                clearTimeout(miniCartTimer);
                updateCartStatus();
                miniCart.classList.add('active');
            });

            // CART 링크에서 마우스 이탈
            cartLink.addEventListener('mouseleave', () => {
                miniCartTimer = setTimeout(() => {
                    miniCart.classList.remove('active');
                }, 500); // 0.5초 대기
            });

            // 팝업창 자체에 마우스 진입 (팝업 유지)
            miniCart.addEventListener('mouseenter', () => {
                clearTimeout(miniCartTimer);
            });

            // 팝업창에서 마우스 이탈
            miniCart.addEventListener('mouseleave', () => {
                miniCartTimer = setTimeout(() => {
                    miniCart.classList.remove('active');
                }, 500);
            });
        }

        const overlay = document.getElementById('loading-overlay');

        function handleTransition(url) {
            overlay.classList.add('is-loading');
            setTimeout(() => {
                window.location.href = url;
            }, 1000); 
        }

        document.querySelectorAll('nav a').forEach(link => {
            link.addEventListener('click', function(e) {
                const targetUrl = this.getAttribute('href');
                if (targetUrl && targetUrl !== '#' && !targetUrl.includes('mailto')) {
                    e.preventDefault();
                    handleTransition(targetUrl);
                }
            });
        });

        window.addEventListener('beforeunload', () => {
            overlay.classList.add('is-loading');
            const start = Date.now();
            while (Date.now() - start < 1000) { }
        });

        // 초기화 로직에 호버 이벤트 추가
        window.addEventListener('load', () => {
            updateCartStatus();
            initCartHoverEvents();
        });

        window.addEventListener('pageshow', () => {
            overlay.classList.remove('is-loading');
            updateCartStatus();
        });
    </script>
</body>
</html>